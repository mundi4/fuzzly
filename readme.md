# 커맨트팔레트 용 "그냥대충 애매하게" 한글 매칭

(텍스트 = 대상 텍스트, 쿼리 = 사용자가 입력한 검색어)

커맨드팔레트(어렴풋이 기억나는 글자나 초성 몇 개 입력-> 결과 추리기-> 바로 실행)에서의 사용이 목적이기 때문에:

1. 완전한 단어나 글자를 기대하지 말고  
   사용자가 어렴풋이 기억하고 있는 글자나 초성을 순서대로(하지만 연속적일 필요는 없음) 입력하는 것 만으로  
   원하는 결과를 찾아낼 수 있어야 함.

2. 입력 과정에서 미완성 글자들도 _자연스럽게_ 매칭에 성공해야함  
   한글은 영문의 알파벳 입력과는 달리 여러 키 입력을 통해 하나의 완전한 글자가 만들어지는데  
   완전한 글자가 만들어지기 전의 중간 단계의 글자(예: `"ㄱ"` > `"가"` > `"갑"` > `"값"`)들도 최종 단계의 글자 `"값"`과 매치가 되어야 함. 키가 입력될 때 마다 결과를 계속 추려서 보여줘야 하니까!  
   `"갑"`을 입력했을 때 결과가 안보이다가 `"값"`까지 입력했을 때 결과가 나타난다면 이건 에러임.
   검색 결과는 키 입력 시마다 범위가 좁혀지는 방향으로만 가야함. 절대 늘어나면 안됨!

3. 받침까지 입력이 된 글자 => 실제로 받침을 의도하지 않고 그 이 후 글자의 초성을 의도한 것일 수 있음.  
   `"갑"`은 정말로 `"갑"`을 의도한 것이 아니라  
   `"가방"`을 입력하던 중간단계일 수 있다는 뜻.  
   혹은 더 나아가서 `"ㅂ"`이 바로 다음 글자가 그냥 그 뒤 어딘가의 아무 글자에 매칭되길 바랬을 수도 있음. 이게 대부분의 커맨트팔레트 기본 동작임.

## 기본적인 매칭 예:

쿼리: `"코"`, `"콧"`, `"콤"`, `"못"` 등등  
텍스트: 코스모스  
받침을 다음 글자로 흘려보내는 매칭은 좀 더 고민해 봐야 함.  
필요하긴 하지만 항상 적절한 것은 아님.

쿼리: `"ㅇㅌㄹ"`, `"ㅇㅅㄹ"`, `"ㅇㅌㅅㅌㄹ"`  
텍스트: 인터스텔라  
단 여기서 `"ㄹ"`은 `"텔"`이 아닌 `"라"`에 매치되어야 함. 받침(종성)을 검색어로 넣는 변태는 없다고 가정.

## 생각의 흐름...

초성 검색은 쉽다. 하지만 입력하는 과정에서 완전하지 않은 입력으로도 유효한 검색결과를 찾아내려면 그 이상이 필요하다!
chatgpt는 각 입력단계마다 그 이후 가능한 문자들을 모두 추출해서 텍스트에 매치를 시켜야된다더라. 그래서 그냥 안할랬는데...  
밥 먹다가 문득... "그냥 텍스트도 키 입력 단계로 쪼개버리면 될 것 아닌가!" (_나 완전 천잰가봐_)

쿼리: `"ㅇㅎㅇ"`  
텍스트: `"안녕하세요"` => "**ㅇ**ㅏㄴㄴㅕㅇ**ㅎ**ㅏㅅㅔ**ㅇ**ㅛ"  
그냥 쉽게 된다!

하지만... 몇가지 신경써야 할 부분이 존재함.

### 문제 1: 사용자는 모음이나 받침을 특정해서 검색하지 않음.

쿼리가 `"ㅂ"`이면 `"비"`, `"박"`, `"번"` 이런 걸 찾고 싶은 거지,  
텍스트 `"갑"`의 받침 `"ㅂ"`까지 매칭되는 걸 의도하지 않는다!

쿼리가 `"가"`라면 `"가"`, `"각"`, `"강"` 등을 찾고 싶은거다.  
즉 모음이 쿼리 내 글자에 포함되는 순간(즉 초성만 입력된 게 아니라면) 그 글자는  
완전한 글자 검색을 의도한 것임. `"고아"`를 찾고 싶은게 아니다.  
(단순 키 입력 단위 매치라면 `"고"`에서 `"ㄱ"`, `"아"`에서 `"ㅏ"`가 매치 성공함)

### 문제 2: 마지막 글자는 확정된 상태가 아님

(사실 더 정확하게 하려면 마지막 글자가 아니라 브라우저의 composition 이벤트에 의해 조합 중인 글자를 찾아야 함. 쉽지 않음.)

`"여름에는 냉면"`이라는 텍스트를 찾기 위해 `"여냉"`을 입력한다면 입력 단계는

```
"ㅇ" > "여" > "연" > "여내" > "여냉"
```

각 입력 단계는 모두 `"여름에는 냉면"`이라는 텍스트가 매치가 되어야 함.  
`"연"`까지 입력한 상태에서 받침 `"ㄴ"`은 종성의 역할을 해도 되지만 그게 실패할 경우(여기서는 실패함)  
`"ㄴ"`은 흘려보내서 이후 글자들의 초성에도 매치시도를 해봐야 함(`spillover`).

하지만 모음은 절대 다음 글자로 넘겨서 시도하면 안됨. 모음으로 시작되는 글자는 없으니까!

(지금은 종성은 무조건 spillover 허용)

### 문제 3: 기타 등등

공백 처리. 어렵다기 보다는 어느 쪽이 맞는 지 판단이 쉽지 않음.

1. 공백을 그냥 리터럴로 여기고 대상 텍스트의 공백과 매치를 시킬지,
1. 공백을 경계로 쪼개서 여러개의 검색어로 활용할 지,
1. 단순히 spillover가 불가능한 경계를 나타낼 지(공백 이후로는 받침을 흘려보내지 않음),
1. 아니면 그냥 완전히 무시할 지...

진짜 왕왕 고민되는 문제...
현재 공백을 경계로 쪼개서 다수의 검색어로 활용하게 하고  
각 검색어들 간의 순서는 중요하지 않게 설계를 했지만  
(사용자가 입력한 검색어의 결과가 너무 많은 경우 다른 검색어를 또 입력해서 결과를 좁힐 수 있게)  
문제는 첫번째 검색어에 매치된 텍스트가 두번째 검색어에도 다시 매치될 경우  
두번째 검색어는 아무 곳에도 매치되지 않은 듯 한 느낌을 받게 된다.  
중복 매치된 텍스트를 특별히 강조시켜 줄 방법도 없고 그러고 싶지도 않다. 지저분해지니까.

vscode에서는 전체 검색어 trim 후 문자 사이의 공백들은 공백 문자 그대로 리터럴로 처리, 대상 텍스트에 공백과 매치를 시키는 것 같다.

...
